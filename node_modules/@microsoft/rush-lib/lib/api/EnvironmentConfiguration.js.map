{"version":3,"file":"EnvironmentConfiguration.js","sourceRoot":"","sources":["../../src/api/EnvironmentConfiguration.ts"],"names":[],"mappings":"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","sourcesContent":["import { InternalError } from '@rushstack/node-core-library';\r\n// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport * as os from 'os';\r\nimport * as path from 'path';\r\nimport { trueCasePathSync } from 'true-case-path';\r\n\r\nimport { IEnvironment } from '../utilities/Utilities';\r\n\r\nexport interface IEnvironmentConfigurationInitializeOptions {\r\n  doNotNormalizePaths?: boolean;\r\n}\r\n\r\n/**\r\n * Names of environment variables used by Rush.\r\n * @public\r\n */\r\nexport const enum EnvironmentVariableNames {\r\n  /**\r\n   * This variable overrides the temporary folder used by Rush.\r\n   * The default value is \"common/temp\" under the repository root.\r\n   */\r\n  RUSH_TEMP_FOLDER = 'RUSH_TEMP_FOLDER',\r\n\r\n  /**\r\n   * This variable overrides the version of Rush that will be installed by\r\n   * the version selector.  The default value is determined by the \"rushVersion\"\r\n   * field from rush.json.\r\n   */\r\n  RUSH_PREVIEW_VERSION = 'RUSH_PREVIEW_VERSION',\r\n\r\n  /**\r\n   * If this variable is set to \"true\", Rush will not fail the build when running a version\r\n   * of Node that does not match the criteria specified in the \"nodeSupportedVersionRange\"\r\n   * field from rush.json.\r\n   */\r\n  RUSH_ALLOW_UNSUPPORTED_NODEJS = 'RUSH_ALLOW_UNSUPPORTED_NODEJS',\r\n\r\n  /**\r\n   * This variable selects a specific installation variant for Rush to use when installing\r\n   * and linking package dependencies.\r\n   * For more information, see the command-line help for the `--variant` parameter\r\n   * and this article:  https://rushjs.io/pages/advanced/installation_variants/\r\n   */\r\n  RUSH_VARIANT = 'RUSH_VARIANT',\r\n\r\n  /**\r\n   * Specifies the maximum number of concurrent processes to launch during a build.\r\n   * For more information, see the command-line help for the `--parallelism` parameter for \"rush build\".\r\n   */\r\n  RUSH_PARALLELISM = 'RUSH_PARALLELISM',\r\n\r\n  /**\r\n   * If this variable is set to \"true\", Rush will create symlinks with absolute paths instead\r\n   * of relative paths. This can be necessary when a repository is moved during a build or\r\n   * if parts of a repository are moved into a sandbox.\r\n   */\r\n  RUSH_ABSOLUTE_SYMLINKS = 'RUSH_ABSOLUTE_SYMLINKS',\r\n\r\n  /**\r\n   * When using PNPM as the package manager, this variable can be used to configure the path that\r\n   * PNPM will use as the store directory.\r\n   *\r\n   * If a relative path is used, then the store path will be resolved relative to the process's\r\n   * current working directory.  An absolute path is recommended.\r\n   */\r\n  RUSH_PNPM_STORE_PATH = 'RUSH_PNPM_STORE_PATH',\r\n\r\n  /**\r\n   * This environment variable can be used to specify the `--target-folder` parameter\r\n   * for the \"rush deploy\" command.\r\n   */\r\n  RUSH_DEPLOY_TARGET_FOLDER = 'RUSH_DEPLOY_TARGET_FOLDER',\r\n\r\n  /**\r\n   * Overrides the location of the `~/.rush` global folder where Rush stores temporary files.\r\n   *\r\n   * @remarks\r\n   *\r\n   * Most of the temporary files created by Rush are stored separately for each monorepo working folder,\r\n   * to avoid issues of concurrency and compatibility between tool versions.  However, a small set\r\n   * of files (e.g. installations of the `@microsoft/rush-lib` engine and the package manager) are stored\r\n   * in a global folder to speed up installations.  The default location is `~/.rush` on POSIX-like\r\n   * operating systems or `C:\\Users\\YourName` on Windows.\r\n   *\r\n   * Use `RUSH_GLOBAL_FOLDER` to specify a different folder path.  This is useful for example if a Windows\r\n   * group policy forbids executing scripts installed in a user's home directory.\r\n   *\r\n   * POSIX is a registered trademark of the Institute of Electrical and Electronic Engineers, Inc.\r\n   */\r\n  RUSH_GLOBAL_FOLDER = 'RUSH_GLOBAL_FOLDER',\r\n\r\n  /**\r\n   * Provides a credential for a remote build cache, if configured. Setting this environment variable\r\n   * overrides a \"isCacheWriteAllowed\": false setting.\r\n   *\r\n   * @remarks\r\n   * This credential overrides any cached credentials.\r\n   *\r\n   * If Azure Blob Storage is used to store cache entries, this must be a SAS token serialized as query\r\n   * parameters.\r\n   *\r\n   * For information on SAS tokens, see here: https://docs.microsoft.com/en-us/azure/storage/common/storage-sas-overview\r\n   */\r\n  RUSH_BUILD_CACHE_WRITE_CREDENTIAL = 'RUSH_BUILD_CACHE_WRITE_CREDENTIAL',\r\n\r\n  /**\r\n   * Allows the git binary path to be explicitly specified.\r\n   */\r\n  RUSH_GIT_BINARY_PATH = 'RUSH_GIT_BINARY_PATH'\r\n}\r\n\r\n/**\r\n * Provides Rush-specific environment variable data. All Rush environment variables must start with \"RUSH_\". This class\r\n * is designed to be used by RushConfiguration.\r\n *\r\n * @remarks\r\n * Initialize will throw if any unknown parameters are present.\r\n */\r\nexport class EnvironmentConfiguration {\r\n  private static _hasBeenInitialized: boolean = false;\r\n\r\n  private static _rushTempFolderOverride: string | undefined;\r\n\r\n  private static _absoluteSymlinks: boolean = false;\r\n\r\n  private static _allowUnsupportedNodeVersion: boolean = false;\r\n\r\n  private static _pnpmStorePathOverride: string | undefined;\r\n\r\n  private static _rushGlobalFolderOverride: string | undefined;\r\n\r\n  private static _buildCacheCredential: string | undefined;\r\n\r\n  private static _gitBinaryPath: string | undefined;\r\n\r\n  /**\r\n   * An override for the common/temp folder path.\r\n   */\r\n  public static get rushTempFolderOverride(): string | undefined {\r\n    EnvironmentConfiguration._ensureInitialized();\r\n    return EnvironmentConfiguration._rushTempFolderOverride;\r\n  }\r\n\r\n  /**\r\n   * If \"true\", create symlinks with absolute paths instead of relative paths.\r\n   * See {@link EnvironmentVariableNames.RUSH_ABSOLUTE_SYMLINKS}\r\n   */\r\n  public static get absoluteSymlinks(): boolean {\r\n    EnvironmentConfiguration._ensureInitialized();\r\n    return EnvironmentConfiguration._absoluteSymlinks;\r\n  }\r\n\r\n  /**\r\n   * If this environment variable is set to \"true\", the Node.js version check will print a warning\r\n   * instead of causing a hard error if the environment's Node.js version doesn't match the\r\n   * version specifier in `rush.json`'s \"nodeSupportedVersionRange\" property.\r\n   *\r\n   * See {@link EnvironmentVariableNames.RUSH_ALLOW_UNSUPPORTED_NODEJS}.\r\n   */\r\n  public static get allowUnsupportedNodeVersion(): boolean {\r\n    EnvironmentConfiguration._ensureInitialized();\r\n    return EnvironmentConfiguration._allowUnsupportedNodeVersion;\r\n  }\r\n\r\n  /**\r\n   * An override for the PNPM store path, if `pnpmStore` configuration is set to 'path'\r\n   * See {@link EnvironmentVariableNames.RUSH_PNPM_STORE_PATH}\r\n   */\r\n  public static get pnpmStorePathOverride(): string | undefined {\r\n    EnvironmentConfiguration._ensureInitialized();\r\n    return EnvironmentConfiguration._pnpmStorePathOverride;\r\n  }\r\n\r\n  /**\r\n   * Overrides the location of the `~/.rush` global folder where Rush stores temporary files.\r\n   * See {@link EnvironmentVariableNames.RUSH_GLOBAL_FOLDER}\r\n   */\r\n  public static get rushGlobalFolderOverride(): string | undefined {\r\n    EnvironmentConfiguration._ensureInitialized();\r\n    return EnvironmentConfiguration._rushGlobalFolderOverride;\r\n  }\r\n\r\n  /**\r\n   * Provides a credential for reading from and writing to a remote build cache, if configured.\r\n   * See {@link EnvironmentVariableNames.RUSH_BUILD_CACHE_CONNECTION_STRING}\r\n   */\r\n  public static get buildCacheWriteCredential(): string | undefined {\r\n    EnvironmentConfiguration._ensureInitialized();\r\n    return EnvironmentConfiguration._buildCacheCredential;\r\n  }\r\n\r\n  /**\r\n   * Allows the git binary path to be explicitly provided.\r\n   * See {@link EnvironmentVariableNames.RUSH_GIT_BINARY_PATH}\r\n   */\r\n  public static get gitBinaryPath(): string | undefined {\r\n    EnvironmentConfiguration._ensureInitialized();\r\n    return EnvironmentConfiguration._gitBinaryPath;\r\n  }\r\n\r\n  /**\r\n   * The front-end RushVersionSelector relies on `RUSH_GLOBAL_FOLDER`, so its value must be read before\r\n   * `EnvironmentConfiguration` is initialized (and actually before the correct version of `EnvironmentConfiguration`\r\n   * is even installed). Thus we need to read this environment variable differently from all the others.\r\n   * @internal\r\n   */\r\n  public static _getRushGlobalFolderOverride(processEnv: IEnvironment): string | undefined {\r\n    const value: string | undefined = processEnv[EnvironmentVariableNames.RUSH_GLOBAL_FOLDER];\r\n    if (value) {\r\n      const normalizedValue: string | undefined = EnvironmentConfiguration._normalizeDeepestParentFolderPath(\r\n        value\r\n      );\r\n      return normalizedValue;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reads and validates environment variables. If any are invalid, this function will throw.\r\n   */\r\n  public static initialize(options: IEnvironmentConfigurationInitializeOptions = {}): void {\r\n    EnvironmentConfiguration.reset();\r\n\r\n    const unknownEnvVariables: string[] = [];\r\n    for (const envVarName in process.env) {\r\n      if (process.env.hasOwnProperty(envVarName) && envVarName.match(/^RUSH_/i)) {\r\n        const value: string | undefined = process.env[envVarName];\r\n        // Environment variables are only case-insensitive on Windows\r\n        const normalizedEnvVarName: string =\r\n          os.platform() === 'win32' ? envVarName.toUpperCase() : envVarName;\r\n        switch (normalizedEnvVarName) {\r\n          case EnvironmentVariableNames.RUSH_TEMP_FOLDER: {\r\n            EnvironmentConfiguration._rushTempFolderOverride =\r\n              value && !options.doNotNormalizePaths\r\n                ? EnvironmentConfiguration._normalizeDeepestParentFolderPath(value) || value\r\n                : value;\r\n            break;\r\n          }\r\n\r\n          case EnvironmentVariableNames.RUSH_ABSOLUTE_SYMLINKS: {\r\n            EnvironmentConfiguration._absoluteSymlinks = value === 'true';\r\n            break;\r\n          }\r\n\r\n          case EnvironmentVariableNames.RUSH_ALLOW_UNSUPPORTED_NODEJS: {\r\n            EnvironmentConfiguration._allowUnsupportedNodeVersion = value === 'true';\r\n            break;\r\n          }\r\n\r\n          case EnvironmentVariableNames.RUSH_PNPM_STORE_PATH: {\r\n            EnvironmentConfiguration._pnpmStorePathOverride =\r\n              value && !options.doNotNormalizePaths\r\n                ? EnvironmentConfiguration._normalizeDeepestParentFolderPath(value) || value\r\n                : value;\r\n            break;\r\n          }\r\n\r\n          case EnvironmentVariableNames.RUSH_GLOBAL_FOLDER: {\r\n            // Handled specially below\r\n            break;\r\n          }\r\n\r\n          case EnvironmentVariableNames.RUSH_BUILD_CACHE_WRITE_CREDENTIAL: {\r\n            EnvironmentConfiguration._buildCacheCredential = value;\r\n            break;\r\n          }\r\n\r\n          case EnvironmentVariableNames.RUSH_GIT_BINARY_PATH: {\r\n            EnvironmentConfiguration._gitBinaryPath = value;\r\n            break;\r\n          }\r\n\r\n          case EnvironmentVariableNames.RUSH_PARALLELISM:\r\n          case EnvironmentVariableNames.RUSH_PREVIEW_VERSION:\r\n          case EnvironmentVariableNames.RUSH_VARIANT:\r\n          case EnvironmentVariableNames.RUSH_DEPLOY_TARGET_FOLDER:\r\n            // Handled by @microsoft/rush front end\r\n            break;\r\n          default:\r\n            unknownEnvVariables.push(envVarName);\r\n            break;\r\n        }\r\n      }\r\n    }\r\n\r\n    // This strictness intends to catch mistakes where variables are misspelled or not used correctly.\r\n    if (unknownEnvVariables.length > 0) {\r\n      throw new Error(\r\n        'The following environment variables were found with the \"RUSH_\" prefix, but they are not ' +\r\n          `recognized by this version of Rush: ${unknownEnvVariables.join(', ')}`\r\n      );\r\n    }\r\n\r\n    // See doc comment for EnvironmentConfiguration._getRushGlobalFolderOverride().\r\n    EnvironmentConfiguration._rushGlobalFolderOverride = EnvironmentConfiguration._getRushGlobalFolderOverride(\r\n      process.env\r\n    );\r\n\r\n    EnvironmentConfiguration._hasBeenInitialized = true;\r\n  }\r\n\r\n  /**\r\n   * Resets EnvironmentConfiguration into an un-initialized state.\r\n   */\r\n  public static reset(): void {\r\n    EnvironmentConfiguration._rushTempFolderOverride = undefined;\r\n\r\n    EnvironmentConfiguration._hasBeenInitialized = false;\r\n  }\r\n\r\n  private static _ensureInitialized(): void {\r\n    if (!EnvironmentConfiguration._hasBeenInitialized) {\r\n      throw new InternalError(\r\n        'The EnvironmentConfiguration must be initialized before values can be accessed.'\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Given a path to a folder (that may or may not exist), normalize the path, including casing,\r\n   * to the first existing parent folder in the path.\r\n   *\r\n   * If no existing path can be found (for example, if the root is a volume that doesn't exist),\r\n   * this function returns undefined.\r\n   *\r\n   * @example\r\n   * If the following path exists on disk: C:\\Folder1\\folder2\\\r\n   * _normalizeFirstExistingFolderPath('c:\\\\folder1\\\\folder2\\\\temp\\\\subfolder')\r\n   * returns 'C:\\\\Folder1\\\\folder2\\\\temp\\\\subfolder'\r\n   */\r\n  private static _normalizeDeepestParentFolderPath(folderPath: string): string | undefined {\r\n    folderPath = path.normalize(folderPath);\r\n    const endsWithSlash: boolean = folderPath.charAt(folderPath.length - 1) === path.sep;\r\n    const parsedPath: path.ParsedPath = path.parse(folderPath);\r\n    const pathRoot: string = parsedPath.root;\r\n    const pathWithoutRoot: string = parsedPath.dir.substr(pathRoot.length);\r\n    const pathParts: string[] = [...pathWithoutRoot.split(path.sep), parsedPath.name].filter(\r\n      (part) => !!part\r\n    );\r\n\r\n    // Starting with all path sections, and eliminating one from the end during each loop iteration,\r\n    // run trueCasePathSync. If trueCasePathSync returns without exception, we've found a subset\r\n    // of the path that exists and we've now gotten the correct casing.\r\n    //\r\n    // Once we've found a parent folder that exists, append the path sections that didn't exist.\r\n    for (let i: number = pathParts.length; i >= 0; i--) {\r\n      const constructedPath: string = path.join(pathRoot, ...pathParts.slice(0, i));\r\n      try {\r\n        const normalizedConstructedPath: string = trueCasePathSync(constructedPath);\r\n        const result: string = path.join(normalizedConstructedPath, ...pathParts.slice(i));\r\n        if (endsWithSlash) {\r\n          return `${result}${path.sep}`;\r\n        } else {\r\n          return result;\r\n        }\r\n      } catch (e) {\r\n        // This path doesn't exist, continue to the next subpath\r\n      }\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n}\r\n"]}