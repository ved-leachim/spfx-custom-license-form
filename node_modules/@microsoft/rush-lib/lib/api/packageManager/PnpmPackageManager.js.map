{"version":3,"file":"PnpmPackageManager.js","sourceRoot":"","sources":["../../../src/api/packageManager/PnpmPackageManager.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;;;;;;;;;;;;;;;;;;;;;AAE3D,+CAAiC;AACjC,6DAA0D;AAC1D,qDAAkD;AAClD,2CAA6B;AAE7B;;GAEG;AACH,MAAa,kBAAmB,SAAQ,+BAAc;IASpD,gBAAgB;IAChB,YAAmB,OAAe;QAChC,KAAK,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;QAEvB,MAAM,aAAa,GAAkB,IAAI,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;QAEhE,IAAI,CAAC,0BAA0B,GAAG,KAAK,CAAC;QAExC,IAAI,aAAa,CAAC,KAAK,IAAI,CAAC,EAAE;YAC5B,IAAI,CAAC,mBAAmB,GAAG,6BAAa,CAAC,wBAAwB,CAAC;YAElE,IAAI,aAAa,CAAC,KAAK,IAAI,CAAC,IAAI,aAAa,CAAC,KAAK,GAAG,CAAC,EAAE;gBACvD,gCAAgC;gBAChC,yEAAyE;gBACzE,IAAI,CAAC,0BAA0B,GAAG,IAAI,CAAC;aACxC;SACF;aAAM;YACL,IAAI,CAAC,mBAAmB,GAAG,6BAAa,CAAC,wBAAwB,CAAC;SACnE;QAED,IAAI,aAAa,CAAC,KAAK,IAAI,CAAC,EAAE;YAC5B,gCAAgC;YAChC,IAAI,CAAC,8BAA8B,GAAG,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,kBAAkB,CAAC,CAAC;SACrF;aAAM,IAAI,aAAa,CAAC,KAAK,IAAI,CAAC,EAAE;YACnC,+BAA+B;YAC/B,IAAI,CAAC,8BAA8B,GAAG,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,iBAAiB,CAAC,CAAC;SACpF;aAAM;YACL,+BAA+B;YAC/B,yEAAyE;YACzE,IAAI,CAAC,8BAA8B,GAAG,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,OAAO,EAAE,WAAW,CAAC,CAAC;SACvF;IACH,CAAC;CACF;AAzCD,gDAyCC","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport * as semver from 'semver';\r\nimport { RushConstants } from '../../logic/RushConstants';\r\nimport { PackageManager } from './PackageManager';\r\nimport * as path from 'path';\r\n\r\n/**\r\n * Support for interacting with the PNPM package manager.\r\n */\r\nexport class PnpmPackageManager extends PackageManager {\r\n  /**\r\n   * PNPM only.  True if `--resolution-strategy` is supported.\r\n   */\r\n  public readonly supportsResolutionStrategy: boolean;\r\n\r\n  // example: node_modules/.pnpm/lock.yaml\r\n  public readonly internalShrinkwrapRelativePath: string;\r\n\r\n  /** @internal */\r\n  public constructor(version: string) {\r\n    super(version, 'pnpm');\r\n\r\n    const parsedVersion: semver.SemVer = new semver.SemVer(version);\r\n\r\n    this.supportsResolutionStrategy = false;\r\n\r\n    if (parsedVersion.major >= 3) {\r\n      this._shrinkwrapFilename = RushConstants.pnpmV3ShrinkwrapFilename;\r\n\r\n      if (parsedVersion.minor >= 1 && parsedVersion.major < 5) {\r\n        // Introduced in version 3.1.0-0\r\n        // Removed in 5.0.0. See https://github.com/pnpm/pnpm/releases/tag/v5.0.0\r\n        this.supportsResolutionStrategy = true;\r\n      }\r\n    } else {\r\n      this._shrinkwrapFilename = RushConstants.pnpmV1ShrinkwrapFilename;\r\n    }\r\n\r\n    if (parsedVersion.major <= 2) {\r\n      // node_modules/.shrinkwrap.yaml\r\n      this.internalShrinkwrapRelativePath = path.join('node_modules', '.shrinkwrap.yaml');\r\n    } else if (parsedVersion.major <= 3) {\r\n      // node_modules/.pnpm-lock.yaml\r\n      this.internalShrinkwrapRelativePath = path.join('node_modules', '.pnpm-lock.yaml');\r\n    } else {\r\n      // node_modules/.pnpm/lock.yaml\r\n      // See https://github.com/pnpm/pnpm/releases/tag/v4.0.0 for more details.\r\n      this.internalShrinkwrapRelativePath = path.join('node_modules', '.pnpm', 'lock.yaml');\r\n    }\r\n  }\r\n}\r\n"]}