{"version":3,"file":"LastLinkFlag.js","sourceRoot":"","sources":["../../src/api/LastLinkFlag.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;;AAE3D,uDAAoD;AACpD,oEAAmF;AAGtE,QAAA,wBAAwB,GAAW,gBAAgB,CAAC;AAEjE;;;;GAIG;AACH,MAAa,YAAa,SAAQ,iCAAe;IAC/C;;OAEG;IACI,OAAO;QACZ,IAAI,QAAgC,CAAC;QACrC,IAAI;YACF,QAAQ,GAAG,4BAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACrC;QAAC,OAAO,GAAG,EAAE;YACZ,gBAAgB;SACjB;QACD,OAAO,CAAC,CAAC,QAAQ,CAAC;IACpB,CAAC;IAED;;OAEG;IACI,8BAA8B;QACnC,MAAM,IAAI,iCAAa,CAAC,iBAAiB,CAAC,CAAC;IAC7C,CAAC;IAED,IAAc,QAAQ;QACpB,OAAO,gCAAwB,CAAC;IAClC,CAAC;CACF;AAxBD,oCAwBC;AAED;;;;GAIG;AACH,MAAa,mBAAmB;IAC9B;;;;;;;OAOG;IACI,MAAM,CAAC,iBAAiB,CAAC,iBAAoC;QAClE,OAAO,IAAI,YAAY,CAAC,iBAAiB,CAAC,gBAAgB,EAAE,EAAE,CAAC,CAAC;IAClE,CAAC;CACF;AAZD,kDAYC","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport { LastInstallFlag } from './LastInstallFlag';\r\nimport { JsonObject, JsonFile, InternalError } from '@rushstack/node-core-library';\r\nimport { RushConfiguration } from './RushConfiguration';\r\n\r\nexport const LAST_LINK_FLAG_FILE_NAME: string = 'last-link.flag';\r\n\r\n/**\r\n * A helper class for managing the last-link flag, which is persistent and\r\n * indicates that linking was completed successfully.\r\n * @internal\r\n */\r\nexport class LastLinkFlag extends LastInstallFlag {\r\n  /**\r\n   * @override\r\n   */\r\n  public isValid(): boolean {\r\n    let oldState: JsonObject | undefined;\r\n    try {\r\n      oldState = JsonFile.load(this.path);\r\n    } catch (err) {\r\n      // Swallow error\r\n    }\r\n    return !!oldState;\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  public checkValidAndReportStoreIssues(): boolean {\r\n    throw new InternalError('Not implemented');\r\n  }\r\n\r\n  protected get flagName(): string {\r\n    return LAST_LINK_FLAG_FILE_NAME;\r\n  }\r\n}\r\n\r\n/**\r\n * A helper class for LastLinkFlag\r\n *\r\n * @internal\r\n */\r\nexport class LastLinkFlagFactory {\r\n  /**\r\n   * Gets the LastLink flag and sets the current state. This state is used to compare\r\n   * against the last-known-good state tracked by the LastLink flag.\r\n   * @param rushConfiguration - the configuration of the Rush repo to get the install\r\n   * state from\r\n   *\r\n   * @internal\r\n   */\r\n  public static getCommonTempFlag(rushConfiguration: RushConfiguration): LastLinkFlag {\r\n    return new LastLinkFlag(rushConfiguration.commonTempFolder, {});\r\n  }\r\n}\r\n"]}