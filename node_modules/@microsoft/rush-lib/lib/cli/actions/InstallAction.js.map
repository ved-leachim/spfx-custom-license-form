{"version":3,"file":"InstallAction.js","sourceRoot":"","sources":["../../../src/cli/actions/InstallAction.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;;AAI3D,2DAAwD;AAIxD,MAAa,aAAc,SAAQ,qCAAiB;IAIlD,YAAmB,MAA6B;QAC9C,KAAK,CAAC;YACJ,UAAU,EAAE,SAAS;YACrB,OAAO,EAAE,4FAA4F;YACrG,aAAa,EACX,iFAAiF;gBACjF,4EAA4E;gBAC5E,sFAAsF;gBACtF,8EAA8E;gBAC9E,8FAA8F;gBAC9F,gFAAgF;gBAChF,uFAAuF;gBACvF,yFAAyF;gBACzF,yFAAyF;gBACzF,+CAA+C;YACjD,MAAM;SACP,CAAC,CAAC;IACL,CAAC;IAED;;OAEG;IACO,kBAAkB;QAC1B,KAAK,CAAC,kBAAkB,EAAE,CAAC;QAC3B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,yBAAyB,CAAC;YAC5C,iBAAiB,EAAE,MAAM;YACzB,kBAAkB,EAAE,IAAI;YACxB,YAAY,EAAE,UAAU;YACxB,WAAW,EACT,iGAAiG;gBACjG,oGAAoG;gBACpG,eAAe;SAClB,CAAC,CAAC;QACH,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,yBAAyB,CAAC;YACrD,iBAAiB,EAAE,qBAAqB;YACxC,YAAY,EAAE,qBAAqB;YACnC,WAAW,EACT,+FAA+F;gBAC/F,wDAAwD;SAC3D,CAAC,CAAC;IACL,CAAC;IAES,mBAAmB;QAC3B,OAAO;YACL,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,OAAO;YAC1B,sBAAsB,EAAE,KAAK;YAC7B,YAAY,EAAE,IAAI,CAAC,sBAAsB,CAAC,KAAM;YAChD,MAAM,EAAE,IAAI,CAAC,gBAAgB,CAAC,KAAM;YACpC,WAAW,EAAE,KAAK;YAClB,iBAAiB,EAAE,KAAK;YACxB,kBAAkB,EAAE,IAAI,CAAC,4BAA4B,CAAC,KAAK;YAC3D,cAAc,EAAE,IAAI,CAAC,6BAA6B,CAAC,KAAM;YACzD,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC,KAAK;YAC5B,iFAAiF;YACjF,kDAAkD;YAClD,kBAAkB,EAAE,IAAI,CAAC,mBAAmB,CAAC,KAAM;YACnD,UAAU,EAAE,IAAI,CAAC,8BAA8B,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,gBAAgB,CAAC;SACrF,CAAC;IACJ,CAAC;CACF;AA/DD,sCA+DC","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport { CommandLineStringListParameter } from '@rushstack/ts-command-line';\r\n\r\nimport { BaseInstallAction } from './BaseInstallAction';\r\nimport { IInstallManagerOptions } from '../../logic/base/BaseInstallManager';\r\nimport { RushCommandLineParser } from '../RushCommandLineParser';\r\n\r\nexport class InstallAction extends BaseInstallAction {\r\n  protected _toFlag!: CommandLineStringListParameter;\r\n  protected _toVersionPolicy!: CommandLineStringListParameter;\r\n\r\n  public constructor(parser: RushCommandLineParser) {\r\n    super({\r\n      actionName: 'install',\r\n      summary: 'Install package dependencies for all projects in the repo according to the shrinkwrap file',\r\n      documentation:\r\n        'The \"rush install\" command installs package dependencies for all your projects,' +\r\n        ' based on the shrinkwrap file that is created/updated using \"rush update\".' +\r\n        ' (This \"shrinkwrap\" file stores a central inventory of all dependencies and versions' +\r\n        ' for projects in your repo. It is found in the \"common/config/rush\" folder.)' +\r\n        ' If the shrinkwrap file is missing or outdated (e.g. because project package.json files have' +\r\n        ' changed), \"rush install\" will fail and tell you to run \"rush update\" instead.' +\r\n        ' This read-only nature is the main feature:  Continuous integration builds should use' +\r\n        ' \"rush install\" instead of \"rush update\" to catch developers who forgot to commit their' +\r\n        ' shrinkwrap changes.  Cautious people can also use \"rush install\" if they want to avoid' +\r\n        ' accidentally updating their shrinkwrap file.',\r\n      parser\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  protected onDefineParameters(): void {\r\n    super.onDefineParameters();\r\n    this._toFlag = this.defineStringListParameter({\r\n      parameterLongName: '--to',\r\n      parameterShortName: '-t',\r\n      argumentName: 'PROJECT1',\r\n      description:\r\n        'Run install in the specified project and all of its dependencies. \".\" can be used as shorthand ' +\r\n        'to specify the project in the current working directory. This argument is only valid in workspace ' +\r\n        'environments.'\r\n    });\r\n    this._toVersionPolicy = this.defineStringListParameter({\r\n      parameterLongName: '--to-version-policy',\r\n      argumentName: 'VERSION_POLICY_NAME',\r\n      description:\r\n        'Run install in all projects with the specified version policy and all of their dependencies. ' +\r\n        'This argument is only valid in workspace environments.'\r\n    });\r\n  }\r\n\r\n  protected buildInstallOptions(): IInstallManagerOptions {\r\n    return {\r\n      debug: this.parser.isDebug,\r\n      allowShrinkwrapUpdates: false,\r\n      bypassPolicy: this._bypassPolicyParameter.value!,\r\n      noLink: this._noLinkParameter.value!,\r\n      fullUpgrade: false,\r\n      recheckShrinkwrap: false,\r\n      networkConcurrency: this._networkConcurrencyParameter.value,\r\n      collectLogFile: this._debugPackageManagerParameter.value!,\r\n      variant: this._variant.value,\r\n      // Because the 'defaultValue' option on the _maxInstallAttempts parameter is set,\r\n      // it is safe to assume that the value is not null\r\n      maxInstallAttempts: this._maxInstallAttempts.value!,\r\n      toProjects: this.mergeProjectsWithVersionPolicy(this._toFlag, this._toVersionPolicy)\r\n    };\r\n  }\r\n}\r\n"]}