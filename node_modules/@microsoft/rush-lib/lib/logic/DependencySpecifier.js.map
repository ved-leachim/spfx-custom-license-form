{"version":3,"file":"DependencySpecifier.js","sourceRoot":"","sources":["../../src/logic/DependencySpecifier.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;;AAE3D,iDAAkD;AAClD,oEAA6D;AAE7D;;GAEG;AACH,IAAY,uBA6CX;AA7CD,WAAY,uBAAuB;IACjC;;OAEG;IACH,sCAAW,CAAA;IAEX;;OAEG;IACH,sCAAW,CAAA;IAEX;;OAEG;IACH,8CAAmB,CAAA;IAEnB;;OAEG;IACH,0CAAe,CAAA;IAEf;;OAEG;IACH,wCAAa,CAAA;IAEb;;OAEG;IACH,kDAAuB,CAAA;IAEvB;;OAEG;IACH,4CAAiB,CAAA;IAEjB;;OAEG;IACH,0CAAe,CAAA;IAEf;;OAEG;IACH,kDAAuB,CAAA;AACzB,CAAC,EA7CW,uBAAuB,GAAvB,+BAAuB,KAAvB,+BAAuB,QA6ClC;AAED;;;;GAIG;AACH,MAAa,mBAAmB;IAwB9B,YAAmB,WAAmB,EAAE,gBAAwB;QAC9D,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;QAC/B,IAAI,CAAC,gBAAgB,GAAG,gBAAgB,CAAC;QAEzC,+EAA+E;QAC/E,gCAAgC;QAChC,IAAI,gBAAgB,CAAC,UAAU,CAAC,YAAY,CAAC,EAAE;YAC7C,IAAI,CAAC,aAAa,GAAG,uBAAuB,CAAC,SAAS,CAAC;YACvD,IAAI,CAAC,gBAAgB,GAAG,gBAAgB,CAAC,KAAK,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;YACrF,IAAI,CAAC,WAAW,GAAG,SAAS,CAAC;YAC7B,OAAO;SACR;QAED,MAAM,MAAM,GAAyB,aAAa,CAAC,OAAO,CAAC,WAAW,EAAE,gBAAgB,CAAC,CAAC;QAC1F,IAAI,CAAC,aAAa,GAAG,mBAAmB,CAAC,0BAA0B,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAEjF,IAAI,IAAI,CAAC,aAAa,KAAK,uBAAuB,CAAC,KAAK,EAAE;YACxD,MAAM,WAAW,GAA8B,MAAmC,CAAC;YACnF,IAAI,CAAC,WAAW,CAAC,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI,EAAE;gBACrD,MAAM,IAAI,iCAAa,CAAC,wCAAwC,CAAC,CAAC;aACnE;YACD,IAAI,CAAC,WAAW,GAAG,IAAI,mBAAmB,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI,EAAE,WAAW,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;SACnG;aAAM;YACL,IAAI,CAAC,WAAW,GAAG,SAAS,CAAC;SAC9B;IACH,CAAC;IAEM,MAAM,CAAC,0BAA0B,CAAC,aAAqB;QAC5D,QAAQ,aAAa,EAAE;YACrB,KAAK,KAAK;gBACR,OAAO,uBAAuB,CAAC,GAAG,CAAC;YACrC,KAAK,KAAK;gBACR,OAAO,uBAAuB,CAAC,GAAG,CAAC;YACrC,KAAK,SAAS;gBACZ,OAAO,uBAAuB,CAAC,OAAO,CAAC;YACzC,KAAK,OAAO;gBACV,OAAO,uBAAuB,CAAC,KAAK,CAAC;YACvC,KAAK,MAAM;gBACT,OAAO,uBAAuB,CAAC,IAAI,CAAC;YACtC,KAAK,WAAW;gBACd,OAAO,uBAAuB,CAAC,SAAS,CAAC;YAC3C,KAAK,QAAQ;gBACX,OAAO,uBAAuB,CAAC,MAAM,CAAC;YACxC,KAAK,OAAO;gBACV,OAAO,uBAAuB,CAAC,KAAK,CAAC;YACvC;gBACE,MAAM,IAAI,iCAAa,CAAC,2CAA2C,aAAa,GAAG,CAAC,CAAC;SACxF;IACH,CAAC;CACF;AAzED,kDAyEC","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport npmPackageArg = require('npm-package-arg');\r\nimport { InternalError } from '@rushstack/node-core-library';\r\n\r\n/**\r\n * The parsed format of a provided version specifier.\r\n */\r\nexport enum DependencySpecifierType {\r\n  /**\r\n   * A git repository\r\n   */\r\n  Git = 'Git',\r\n\r\n  /**\r\n   * A tagged version, e.g. \"example@latest\"\r\n   */\r\n  Tag = 'Tag',\r\n\r\n  /**\r\n   * A specific version number, e.g. \"example@1.2.3\"\r\n   */\r\n  Version = 'Version',\r\n\r\n  /**\r\n   * A version range, e.g. \"example@2.x\"\r\n   */\r\n  Range = 'Range',\r\n\r\n  /**\r\n   * A local .tar.gz, .tar or .tgz file\r\n   */\r\n  File = 'File',\r\n\r\n  /**\r\n   * A local directory\r\n   */\r\n  Directory = 'Directory',\r\n\r\n  /**\r\n   * An HTTP url to a .tar.gz, .tar or .tgz file\r\n   */\r\n  Remote = 'Remote',\r\n\r\n  /**\r\n   * A package alias, e.g. \"npm:other-package@^1.2.3\"\r\n   */\r\n  Alias = 'Alias',\r\n\r\n  /**\r\n   * A package specified using workspace protocol, e.g. \"workspace:^1.2.3\"\r\n   */\r\n  Workspace = 'Workspace'\r\n}\r\n\r\n/**\r\n * An NPM \"version specifier\" is a string that can appear as a package.json \"dependencies\" value.\r\n * Example version specifiers: `^1.2.3`, `file:./blah.tgz`, `npm:other-package@~1.2.3`, and so forth.\r\n * A \"dependency specifier\" is the version specifier information, combined with the dependency package name.\r\n */\r\nexport class DependencySpecifier {\r\n  /**\r\n   * The dependency package name, i.e. the key from a \"dependencies\" key/value table.\r\n   */\r\n  public readonly packageName: string;\r\n\r\n  /**\r\n   * The dependency version specifier, i.e. the value from a \"dependencies\" key/value table.\r\n   * Example values: `^1.2.3`, `file:./blah.tgz`, `npm:other-package@~1.2.3`\r\n   */\r\n  public readonly versionSpecifier: string;\r\n\r\n  /**\r\n   * The type of the `versionSpecifier`.\r\n   */\r\n  public readonly specifierType: DependencySpecifierType;\r\n\r\n  /**\r\n   * If `specifierType` is `alias`, then this is the parsed target dependency.\r\n   * For example, if version specifier i `\"npm:other-package@^1.2.3\"` then this is the parsed object for\r\n   * `other-package@^1.2.3`.\r\n   */\r\n  public readonly aliasTarget: DependencySpecifier | undefined;\r\n\r\n  public constructor(packageName: string, versionSpecifier: string) {\r\n    this.packageName = packageName;\r\n    this.versionSpecifier = versionSpecifier;\r\n\r\n    // Workspace ranges are a feature from PNPM and Yarn. Set the version specifier\r\n    // to the trimmed version range.\r\n    if (versionSpecifier.startsWith('workspace:')) {\r\n      this.specifierType = DependencySpecifierType.Workspace;\r\n      this.versionSpecifier = versionSpecifier.slice(this.specifierType.length + 1).trim();\r\n      this.aliasTarget = undefined;\r\n      return;\r\n    }\r\n\r\n    const result: npmPackageArg.Result = npmPackageArg.resolve(packageName, versionSpecifier);\r\n    this.specifierType = DependencySpecifier.getDependencySpecifierType(result.type);\r\n\r\n    if (this.specifierType === DependencySpecifierType.Alias) {\r\n      const aliasResult: npmPackageArg.AliasResult = result as npmPackageArg.AliasResult;\r\n      if (!aliasResult.subSpec || !aliasResult.subSpec.name) {\r\n        throw new InternalError('Unexpected result from npm-package-arg');\r\n      }\r\n      this.aliasTarget = new DependencySpecifier(aliasResult.subSpec.name, aliasResult.subSpec.rawSpec);\r\n    } else {\r\n      this.aliasTarget = undefined;\r\n    }\r\n  }\r\n\r\n  public static getDependencySpecifierType(specifierType: string): DependencySpecifierType {\r\n    switch (specifierType) {\r\n      case 'git':\r\n        return DependencySpecifierType.Git;\r\n      case 'tag':\r\n        return DependencySpecifierType.Tag;\r\n      case 'version':\r\n        return DependencySpecifierType.Version;\r\n      case 'range':\r\n        return DependencySpecifierType.Range;\r\n      case 'file':\r\n        return DependencySpecifierType.File;\r\n      case 'directory':\r\n        return DependencySpecifierType.Directory;\r\n      case 'remote':\r\n        return DependencySpecifierType.Remote;\r\n      case 'alias':\r\n        return DependencySpecifierType.Alias;\r\n      default:\r\n        throw new InternalError(`Unexpected npm-package-arg result type \"${specifierType}\"`);\r\n    }\r\n  }\r\n}\r\n"]}