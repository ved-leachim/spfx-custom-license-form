{"version":3,"file":"InstallManagerFactory.js","sourceRoot":"","sources":["../../src/logic/InstallManagerFactory.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;;;;;;;;;;;;;;;;;;;;;;;;AAE3D,oDAA4B;AAC5B,+CAAiC;AAEjC,oEAA4E;AAE5E,sFAAmF;AAKnF,MAAM,wBAAwB,GAAyD,0BAAM,CAAC,IAAI,CAChG,qCAAqC,EACrC,OAAO,CACR,CAAC;AAEF,MAAa,qBAAqB;IACzB,MAAM,CAAC,iBAAiB,CAC7B,iBAAoC,EACpC,gBAAkC,EAClC,YAA0B,EAC1B,OAA+B;QAE/B,IACE,iBAAiB,CAAC,cAAc,KAAK,MAAM;YAC3C,iBAAiB,CAAC,WAAW;YAC7B,iBAAiB,CAAC,WAAW,CAAC,aAAa,EAC3C;YACA,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,iBAAiB,CAAC,yBAAyB,EAAE,UAAU,CAAC,EAAE;gBAC9E,OAAO,CAAC,GAAG,EAAE,CAAC;gBACd,OAAO,CAAC,GAAG,CACT,gBAAM,CAAC,GAAG,CACR,sGAAsG,CACvG,CACF,CAAC;gBACF,MAAM,IAAI,wCAAoB,EAAE,CAAC;aAClC;YAED,OAAO,IAAI,iDAAuB,CAAC,iBAAiB,EAAE,gBAAgB,EAAE,YAAY,EAAE,OAAO,CAAC,CAAC;SAChG;QAED,OAAO,IAAI,wBAAwB,CAAC,kBAAkB,CACpD,iBAAiB,EACjB,gBAAgB,EAChB,YAAY,EACZ,OAAO,CACR,CAAC;IACJ,CAAC;CACF;AAhCD,sDAgCC","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport colors from 'colors';\r\nimport * as semver from 'semver';\r\n\r\nimport { AlreadyReportedError, Import } from '@rushstack/node-core-library';\r\nimport { BaseInstallManager, IInstallManagerOptions } from './base/BaseInstallManager';\r\nimport { WorkspaceInstallManager } from './installManager/WorkspaceInstallManager';\r\nimport { PurgeManager } from './PurgeManager';\r\nimport { RushConfiguration } from '../api/RushConfiguration';\r\nimport { RushGlobalFolder } from '../api/RushGlobalFolder';\r\n\r\nconst rushInstallManagerModule: typeof import('./installManager/RushInstallManager') = Import.lazy(\r\n  './installManager/RushInstallManager',\r\n  require\r\n);\r\n\r\nexport class InstallManagerFactory {\r\n  public static getInstallManager(\r\n    rushConfiguration: RushConfiguration,\r\n    rushGlobalFolder: RushGlobalFolder,\r\n    purgeManager: PurgeManager,\r\n    options: IInstallManagerOptions\r\n  ): BaseInstallManager {\r\n    if (\r\n      rushConfiguration.packageManager === 'pnpm' &&\r\n      rushConfiguration.pnpmOptions &&\r\n      rushConfiguration.pnpmOptions.useWorkspaces\r\n    ) {\r\n      if (!semver.satisfies(rushConfiguration.packageManagerToolVersion, '>=4.14.3')) {\r\n        console.log();\r\n        console.log(\r\n          colors.red(\r\n            'Workspaces are only supported in Rush for PNPM >=4.14.3. Upgrade PNPM to use the workspaces feature.'\r\n          )\r\n        );\r\n        throw new AlreadyReportedError();\r\n      }\r\n\r\n      return new WorkspaceInstallManager(rushConfiguration, rushGlobalFolder, purgeManager, options);\r\n    }\r\n\r\n    return new rushInstallManagerModule.RushInstallManager(\r\n      rushConfiguration,\r\n      rushGlobalFolder,\r\n      purgeManager,\r\n      options\r\n    );\r\n  }\r\n}\r\n"]}