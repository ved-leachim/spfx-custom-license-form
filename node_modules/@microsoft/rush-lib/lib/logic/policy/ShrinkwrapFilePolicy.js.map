{"version":3,"file":"ShrinkwrapFilePolicy.js","sourceRoot":"","sources":["../../../src/logic/policy/ShrinkwrapFilePolicy.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;;;;;;;;;;;;;;;;;;;;;AAE3D,uCAAyB;AAKzB,oEAAiE;AAOjE;;GAEG;AACH,MAAa,oBAAoB;IACxB,MAAM,CAAC,QAAQ,CAAC,iBAAoC,EAAE,OAAgC;QAC3F,OAAO,CAAC,GAAG,CAAC,6CAA6C,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;QACpE,MAAM,cAAc,GAAmC,6CAAqB,CAAC,iBAAiB,CAC5F,iBAAiB,CAAC,cAAc,EAChC,iBAAiB,CAAC,qBAAqB,EACvC,iBAAiB,CAAC,8BAA8B,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAC5E,CAAC;QAEF,IAAI,CAAC,cAAc,EAAE;YACnB,OAAO,CAAC,GAAG,CAAC,0DAA0D,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;YACjF,OAAO;SACR;QAED,qCAAqC;QACrC,cAAc,CAAC,QAAQ,CAAC,iBAAiB,CAAC,qBAAqB,kCAC1D,OAAO,KACV,SAAS,EAAE,iBAAiB,CAAC,YAAY,CAAC,OAAO,CAAC,iBAAiB,CAAC,IACpE,CAAC;IACL,CAAC;CACF;AApBD,oDAoBC","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport * as os from 'os';\r\n\r\nimport { RushConfiguration } from '../../api/RushConfiguration';\r\nimport { IPolicyValidatorOptions } from './PolicyValidator';\r\nimport { BaseShrinkwrapFile } from '../base/BaseShrinkwrapFile';\r\nimport { ShrinkwrapFileFactory } from '../ShrinkwrapFileFactory';\r\nimport { RepoStateFile } from '../RepoStateFile';\r\n\r\nexport interface IShrinkwrapFilePolicyValidatorOptions extends IPolicyValidatorOptions {\r\n  repoState: RepoStateFile;\r\n}\r\n\r\n/**\r\n *  A policy that validates shrinkwrap files used by package managers.\r\n */\r\nexport class ShrinkwrapFilePolicy {\r\n  public static validate(rushConfiguration: RushConfiguration, options: IPolicyValidatorOptions): void {\r\n    console.log('Validating package manager shrinkwrap file.' + os.EOL);\r\n    const shrinkwrapFile: BaseShrinkwrapFile | undefined = ShrinkwrapFileFactory.getShrinkwrapFile(\r\n      rushConfiguration.packageManager,\r\n      rushConfiguration.packageManagerOptions,\r\n      rushConfiguration.getCommittedShrinkwrapFilename(options.shrinkwrapVariant)\r\n    );\r\n\r\n    if (!shrinkwrapFile) {\r\n      console.log('Shrinkwrap file could not be found, skipping validation.' + os.EOL);\r\n      return;\r\n    }\r\n\r\n    // Run shrinkwrap-specific validation\r\n    shrinkwrapFile.validate(rushConfiguration.packageManagerOptions, {\r\n      ...options,\r\n      repoState: rushConfiguration.getRepoState(options.shrinkwrapVariant)\r\n    });\r\n  }\r\n}\r\n"]}