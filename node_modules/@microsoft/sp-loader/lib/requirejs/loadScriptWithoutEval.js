import { _BrowserDetection, _Browser } from '@microsoft/sp-core-library';
import isCorsEnabled from '../utilities/isCorsEnabled';
/**
 * Start download the script without evaluating it.
 * For chromium based browsers, Edge, Safari and Firefox use <link rel='preload'>.
 * For IE, use <script type= 'text/cache'>. Wrong type will let IE avoid evaluating.
 * For other browser, won't affect.
 *
 * Tested in Chrome, Edge Chromium, Edge, Safari, IE, Firefox.
 *
 * @param scriptUrl The script url.
 */
export function loadScriptWithoutEval(scriptUrl, appendJSExtension) {
    if (appendJSExtension === void 0) { appendJSExtension = true; }
    if (!document) {
        return Promise.resolve();
    }
    if (appendJSExtension) {
        scriptUrl = scriptUrl + ".js";
    }
    return new Promise(function (resolve, reject) {
        var browser = _BrowserDetection.getBrowserInformation().browser;
        var isCrossOrigin = isCorsEnabled(scriptUrl);
        switch (browser) {
            case _Browser.Chrome:
            case _Browser.EdgeChromium:
            case _Browser.Edge:
            case _Browser.Safari:
            case _Browser.Firefox: {
                var link = document.createElement('link');
                link.as = 'script';
                link.rel = 'preload';
                if (isCrossOrigin) {
                    link.crossOrigin = 'anonymous';
                }
                link.href = scriptUrl;
                link.onload = function () { return resolve(); };
                link.onerror = function (e) { return reject(e); };
                document.head.appendChild(link);
                break;
            }
            case _Browser.IE: {
                var script = document.createElement('script');
                // IE will not evaluate the script.
                script.type = 'text/cache';
                script.src = scriptUrl;
                if (isCrossOrigin) {
                    script.crossOrigin = 'anonymous';
                }
                document.head.appendChild(script);
                break;
            }
            default: {
                resolve();
            }
        }
    });
}
//# sourceMappingURL=loadScriptWithoutEval.js.map