// Copyright (c) Microsoft. All rights reserved.
import { _PerformanceLogger } from '@ms/sp-telemetry';
import { O365ShellPromises } from '@ms/sp-suite-nav';
import { Flights } from '../common/Flights';
import SPGlobalErrorHandler from '../error/SPGlobalErrorHandler';
var SPMasterChrome = /** @class */ (function () {
    function SPMasterChrome() {
        this._isVisible = false;
        this._isDisposed = false;
        this._createPageChrome();
    }
    /**
     * Shows the chrome.
     */
    SPMasterChrome.prototype.show = function () {
        var _this = this;
        if (!this._isDisposed && !this._isVisible) {
            if (!Flights.serviceWorker || !this._chromeDiv.isConnected) {
                document.body.appendChild(this._chromeDiv);
            }
            if (Flights.preloadSuiteNav) {
                if (O365ShellPromises.GetLoadPromise()) {
                    // tslint:disable-next-line: no-floating-promises
                    O365ShellPromises.GetLoadPromise().then(function () {
                        var searchBoxInput = _this.getSearchBoxInput();
                        var selectionStart = searchBoxInput.selectionStart, selectionEnd = searchBoxInput.selectionEnd;
                        var searchBoxInputActive = document.activeElement === searchBoxInput;
                        var suiteNavPlaceholder = document.getElementById('SuiteNavPlaceholder');
                        _this._suiteNavDiv.appendChild(suiteNavPlaceholder);
                        if (searchBoxInputActive) {
                            searchBoxInput.focus();
                            searchBoxInput.selectionStart = selectionStart;
                            searchBoxInput.selectionEnd = selectionEnd;
                        }
                    });
                }
            }
            this._isVisible = true;
        }
    };
    /**
     * Hides the chrome.
     */
    SPMasterChrome.prototype.hide = function () {
        if (!this._isDisposed && this._isVisible) {
            this._chromeDiv = document.body.removeChild(this._chromeDiv);
            this._isVisible = false;
        }
    };
    /**
     * Disposes the Chrome
     */
    SPMasterChrome.prototype.dispose = function () {
        if (!this._isDisposed) {
            this._chromeDiv = document.body.removeChild(this._chromeDiv);
            // tslint:disable-next-line:no-any
            delete this._suiteNavDiv;
            // tslint:disable-next-line:no-any
            delete this._chromeDiv;
            this._isDisposed = true;
        }
    };
    Object.defineProperty(SPMasterChrome.prototype, "chromeDiv", {
        /**
         * Gets the chrome div
         */
        get: function () {
            return this._chromeDiv;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(SPMasterChrome.prototype, "suiteNavDiv", {
        /**
         * Gets the suite nav div
         */
        get: function () {
            return this._suiteNavDiv;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(SPMasterChrome.prototype, "isDisposed", {
        /**
         * Returns true if the object has already been disposed, otherwise false.
         */
        get: function () {
            return this._isDisposed;
        },
        enumerable: false,
        configurable: true
    });
    SPMasterChrome.prototype.getSearchBoxInput = function () {
        var searchBoxContainer = document.getElementById('sbcId');
        if (searchBoxContainer) {
            var inputs = searchBoxContainer.getElementsByTagName('input');
            if (inputs.length) {
                return inputs[0];
            }
        }
        return { selectionStart: 0, selectionEnd: 0, focus: function () { return void 0; } };
    };
    SPMasterChrome.prototype._createPageChrome = function () {
        _PerformanceLogger.devMark('SPPageChrome.createPageChromeMaster');
        // Page body
        document.body.className = 'ms-font-m';
        //
        // NOTE: Service worker pre-renders SPPageChrome and its containing SuiteNavWrapper when active
        //
        if (Flights.serviceWorker) {
            this._chromeDiv = document.getElementById('SPPageChrome');
            this._suiteNavDiv = document.getElementById('SuiteNavWrapper');
        }
        //
        // TODO:
        // move below branch as an else on above if once odsp-common service worker changes is
        // deployed to guarantee creation of SPPageChrome from service worker
        //
        // Page Chrome div
        if (!this._chromeDiv) {
            this._chromeDiv = document.createElement('div');
            var chromeDivClasses = 'SPPageChrome';
            if (Flights.isFluentEnabled) {
                chromeDivClasses += ' isFluent';
            }
            else {
                chromeDivClasses += ' isNotFluent';
            }
            this._chromeDiv.setAttribute('class', chromeDivClasses);
            this._suiteNavDiv = document.createElement('div');
            this._suiteNavDiv.setAttribute('id', 'SuiteNavWrapper');
            this._chromeDiv.appendChild(this._suiteNavDiv);
        }
        if (!window.onerror) {
            window.onerror = SPGlobalErrorHandler.basicTracingHandler;
        }
    };
    return SPMasterChrome;
}());
export default SPMasterChrome;
//# sourceMappingURL=SPMasterChrome.js.map